<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<style>
    .table-content {
      border-collapse: collapse;
      font-family: 'Roboto Regular', sans-serif;
      font-size: 13px;
      background-color: #FFFFFF;
      border: 1px solid #e5e5e5;
      color: rgba(0, 0, 0, 0.87);
      border-radius: 3px;
    }
    .table-content thead{
      padding-left: 50px;
      color: rgba(0, 0, 0, 0.57);
      height: 56px;
    }
    .table-content tbody tr:hover{
      background-color: #EEEEEE;
      cursor: pointer;
    }
    .table-content tr{
      border-bottom: 2px solid #EEEEEE;
      height: 48px;
    }
    .table-content tr td:first-child {
      padding-left: 20px;
      padding-right: 56px;
    }
    .table-content tr td:not(:first-child) {
      padding-left: 56px;
      padding-right: 56px;
    }
</style>
  
<dom-module id="ctable-element">
  <template>
    <table class="table-content">
      <!-- column header -->
      <thead>
        <tr>
         <td>
           <paper-checkbox id="checkAll" on-change="handleSelectAll">
           </paper-checkbox>
         </td>
         <template is="dom-repeat" items="[[columns]]">
         <td>{{item.label}}</td>
         </template>
        </tr>
      </thead>
      <!-- table body -->
      <tbody id="content">
        <template is="dom-repeat" items="[[data]]" as="row">
          <tr>
           <td>
            <paper-checkbox on-change="handleSelect">
            </paper-checkbox>
           </td>
           <template is="dom-repeat" items="[[columns]]" as="col">
           <td>{{_getObjectValue(row,col)}}</td>
           </template>
          </tr>
        </template>
      </tbody>
    </table>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'ctable-element',
    properties: {
      columns: { 
        type:Array,
        notify: true
      },
      data: Array,
      selected : {
        type: Array,
        notify: true
      }
    },
    handleSelectAll: function(e) {
      console.log(this.columns);
      var trList = Polymer.dom(this.$.content).querySelectorAll('tr');
      for(var i=0;i<trList.length;i++) {
        var checkbox = Polymer.dom(trList[i].firstElementChild).querySelector('paper-checkbox');
        checkbox.checked = e.srcElement.checked;
        var trElement = checkbox.parentElement.parentNode;
        if(e.srcElement.checked) {
          trElement.style.backgroundColor = "#F5F5F5";
        } else {
          trElement.removeAttribute("style");
        }
      }
      this._updateSelected();
    },
    _updateSelected : function() {
      var tmp = [];
      var trList = Polymer.dom(this.$.content).querySelectorAll('tr');
      for(var i=0;i<trList.length;i++) {
        var checkbox = Polymer.dom(trList[i].firstElementChild).querySelector('paper-checkbox');
        if(checkbox.checked) {
          tmp.push(this.data[i]);
        }
      }
      this.selected = tmp;
      console.log(this.selected);
    },
    _getObjectValue: function(obj,col) {
      return obj[col.property];
    },
    handleSelect: function(e) {
      this.$.checkAll.checked = false;
      var tdElement = e.srcElement.parentElement;
      var trElement = tdElement.parentNode;
      if(e.srcElement.checked) {
        trElement.style.backgroundColor = "#F5F5F5";
      } else {
        trElement.removeAttribute("style");
      }
      this._updateSelected();
    }
  });
</script>
