<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<style>
    :host {
      display: block;
    }
    .table-content {
      width: 100%;
      border-collapse: collapse;
      font-family: 'Roboto Regular', sans-serif;
      font-size: 13px;
      background-color: #FFFFFF;
      border: 1px solid #e5e5e5;
      color: rgba(0, 0, 0, 0.87);
      border-radius: 3px;
    }
    .table-content thead tr{
      padding-left: 50px;
      color: rgba(0, 0, 0, 0.57);
      height: 64px;
    }
    .table-content tbody tr:hover{
      background-color: #EEEEEE;
      cursor: pointer;
    }
    .table-content tr{
      border-bottom: 2px solid #EEEEEE;
      height: 48px;
    }
    .table-content tfoot tr{
      height: 56px;
      text-align: right;
    }
    .table-content tr td:first-child {
      width: 48px;
      padding-left: 24px;
    }
    .table-content tr td:nth-child(2) {
      padding-left: 0px;
      padding-right: 56px;
    }
    .table-content tr td:nth-child(n+3) {
      padding-left: 56px;
      padding-right: 56px;
    }
    .td-is-number{
      text-align: right;
    }
</style>
  
<dom-module id="ctable-element">
  <template>
    <table class="table-content">
      <!-- column header -->
      <thead>
        <tr>
         <td>
           <paper-checkbox id="checkAll" on-change="handleSelectAll"></paper-checkbox>
         </td>
         <template is="dom-repeat" items="[[columns]]">
          <td class$="{{_renderClass(item)}}">{{item.label}}</td>
         </template>
        </tr>
      </thead>
      <!-- table body -->
      <tbody id="content">
        <template is="dom-repeat" items="[[data]]" as="row">
          <tr>
            <td>
              <paper-checkbox on-change="handleSelect"></paper-checkbox>
            </td>
            <template is="dom-repeat" items="[[columns]]" as="col">
              <td class$="{{_renderClass(col)}}">{{_getObjectValue(row,col)}}</td>
            </template>
          </tr>
        </template>
      </tbody>
      <tfoot>
        <tr>
          <td></td>
          <td colspan$="[[columns.length]]">Rows per page:</td>
        </tr>
      </tfoot>
    </table>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'ctable-element',
    properties: {
      columns: { 
        type:Array,
        notify: true
      },
      data: Array,
      selected : {
        type: Array,
        notify: true
      }
    },
    handleSelectAll: function(e) {
      console.log(this.columns);
      var trList = Polymer.dom(this.$.content).querySelectorAll('tr');
      for(var i=0;i<trList.length;i++) {
        var checkbox = Polymer.dom(trList[i].firstElementChild).querySelector('paper-checkbox');
        checkbox.checked = e.srcElement.checked;
        var trElement = checkbox.parentElement.parentNode;
        if(e.srcElement.checked) {
          trElement.style.backgroundColor = "#F5F5F5";
        } else {
          trElement.removeAttribute("style");
        }
      }
      this._updateSelected();
    },
    _updateSelected : function() {
      var tmp = [];
      var trList = Polymer.dom(this.$.content).querySelectorAll('tr');
      for(var i=0;i<trList.length;i++) {
        var checkbox = Polymer.dom(trList[i].firstElementChild).querySelector('paper-checkbox');
        if(checkbox.checked) {
          tmp.push(this.data[i]);
        }
      }
      this.selected = tmp;
      console.log(this.selected);
    },
    _getObjectValue: function(obj,col) {
      return obj[col.property];
    },
     _renderClass: function(col) {
      if(col.type.toLocaleLowerCase() == 'number'){
        return 'td-is-number';
      }
    },
    handleSelect: function(e) {
      this.$.checkAll.checked = false;
      var tdElement = e.srcElement.parentElement;
      var trElement = tdElement.parentNode;
      if(e.srcElement.checked) {
        trElement.style.backgroundColor = "#F5F5F5";
      } else {
        trElement.removeAttribute("style");
      }
      this._updateSelected();
    }
  });
</script>
